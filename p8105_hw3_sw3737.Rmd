---
title: "p8105_hw3_sw3737"
author: "sw3737"
date: "2023-10-14"
output: github_document
---

## Problem 2

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
```

# Data import

```{r}
library(p8105.datasets)
data("brfss_smart2010")
```

# Data cleaning

```{r}
brfss_clean <- brfss_smart2010 %>% 
  janitor::clean_names() %>%
  filter(topic == "Overall Health", 
         response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  mutate(response = factor(response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent")))
```

# State analysis for 2002 and 2010

```{r}
brfss_clean %>%
  group_by(year, locationabbr) %>%
  summarise(counties = n_distinct(locationdesc)) %>%
  filter((year == 2002 | year == 2010) & counties >= 7)
```

Comments: In 2002, 6 states were observed at 7 or more locations (CT, FL, MA, NC, NJ, PA). In 2010, 14 states were observed at 7 or more locations (CA, CO, FL, MA, MD, NC, NE, NJ, NY, OH, PA, SC, TX, WA).

# Construct a dataset

```{r}
excellent_data <- brfss_clean %>% 
  filter(response == "Excellent") %>%
  group_by(year, locationabbr) %>%
  summarise(avg_data_value = mean(data_value, na.rm = TRUE), .groups = "drop")

ggplot(excellent_data, aes(x = year, y = avg_data_value, group = locationabbr, color = locationabbr)) +
  geom_line() +
  labs(title = "Average Value of 'Excellent' Responses Over Time by State",
       x = "Year", y = "Average Value") +
  theme_minimal() 
```

Comments: The "spaghetti" plot only contains `excellent` responses, `year`, `state`, and the `average values` across locations within a state.

# Two-Panel Plot for 2006 and 2010

```{r}
ny_data <- brfss_clean %>% 
  filter(locationabbr == "NY", year %in% c(2006, 2010))

ggplot(ny_data, aes(x = response, y = data_value)) +
  geom_boxplot() +
  facet_wrap(~ year) +
  labs(title = "Distribution of Responses in NY for 2006 and 2010",
       x = "Response", y = "Data Value") +
  theme_minimal()
```

Comments: These two-panel plots show the distribution of `data_value` for responses from `poor` to `excellent` among locations in NY State. Data in 2010 has an overall higher values than 2006 in all five response groups.

## Problem 2

```{r set, include=FALSE}
library(readr)
library(tidyverse)
library(tidyr)
library(dplyr)
library(janitor)
```

# Demographics data cleaning

```{r}
nhanes_covar <- read_csv("Data files/nhanes_covar.csv", skip = 4) %>%
  janitor::clean_names() %>% 
  mutate(
    sex = recode(sex, "1" = "male", "2" = "female"),
    education = recode(education, 
                       "1" = "Less than high school",
                       "2" = "High school equivalent",
                       "3" = "More than high school")
  ) %>%
  filter(age >= 21 & 
         !is.na(sex) & 
         !is.na(age) & 
         !is.na(bmi) & 
         !is.na(education))
```

# Accelerometer data cleaning and merge the two datasets

```{r}
nhanes_accel <- read_csv("Data files/nhanes_accel.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    min1:min1440,
    names_to = "min",
    values_to = "min_value"
  ) %>%
  separate(min, into = c("prefix","min"), sep = 3) %>%
  select(-prefix)
  
merged_data <- inner_join(nhanes_accel, nhanes_covar, by = "seqn") %>%
    mutate(education = factor(education, levels = c("Less than high school", "High school equivalent", "More than high school")))
```
